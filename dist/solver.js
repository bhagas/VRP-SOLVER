(()=>{let t;$("#files").bind("change",(function(t){var a=t.target.files[0],o=`\n      <span style="font-weight:bold;">${escape(a.name)}</span><br>\n      - FileType: ${a.type||"n/a"}<br>\n      - FileSize: ${a.size} bytes<br>\n      - LastModified: ${a.lastModifiedDate?a.lastModifiedDate.toLocaleDateString():"n/a"}\n    `;console.log(o);var n=new FileReader;n.readAsText(a),n.onload=function(t){var a=t.target.result;e=$.csv.toObjects(a);for(let t=0;t<e.length;t++)e[t].Latitude=e[t].Latitude.replace(",","."),e[t].Longitude=e[t].Longitude.replace(",","."),e[t].KG=e[t].KG.replace(",","."),e[t].M2=e[t].M2.replace(",","."),$("#tabelnya").append(`<tr><td><input type="text" class="lng form-control" value="${e[t].Latitude}"></td>\n        <td><input type="text" class="lat form-control" value="${e[t].Longitude}"></td>\n        <td><input type="text" class="volume form-control" value="${e[t].M2}"></td>\n        <td><input type="text" class="berat form-control" value="${e[t].KG}"></td>\n        <td><a href="#" class="DeleteButton">Hapus</a></td></tr>`);console.log(e)}}));let e=[];mapboxgl.accessToken="pk.eyJ1IjoiYmhhZ2FzIiwiYSI6ImNsZnNlaXRqNjA1ZDAzY2wydzhkNndpbWEifQ.7fH0v4wHwHD9n1dJFM8gXA";const a=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/traffic-night-v2",center:[110.416664,-6.966667],zoom:9});a.on("load",(()=>{a.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png",((e,o)=>{if(e)throw e;a.addImage("custom-marker",o,{sdf:!0}),a.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a.addLayer({id:"route",type:"line",source:"route",paint:{"line-width":["get","stroke-width"],"line-color":["get","stroke"]},filter:["==","$type","LineString"]}),a.addLayer({id:"titik",type:"symbol",source:"route",layout:{"icon-allow-overlap":!0,"text-field":["get","marker-symbol"],"icon-image":"custom-marker","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.25],"text-anchor":"top"},paint:{"text-color":["get","marker-color"],"icon-color":["get","marker-color"]},filter:["==","$type","Point"]}),a.on("click","route",(e=>{let o="",n=new Date(1e3*e.features[0].properties.duration).toISOString().substring(11,16).split(":");o+="rute untuk mobil ke: "+e.features[0].properties.route,o+="</br>Jarak PP: "+(e.features[0].properties.distance/1e3).toFixed(2)+" Km",o+="</br>Waktu tempuh PP: "+n[0]+" Jam "+n[1]+" Menit",t=(new mapboxgl.Popup).setLngLat(e.lngLat).setHTML(o).addTo(a)})),a.on("click","titik",(e=>{let o="";console.log(e.features[0]),o+="pemberhentian ke: "+e.features[0].properties.stop,t=(new mapboxgl.Popup).setLngLat(e.lngLat).setHTML(o).addTo(a)})),a.on("mouseenter","route",(()=>{a.getCanvas().style.cursor="pointer"})),a.on("mouseleave","route",(()=>{a.getCanvas().style.cursor=""})),a.on("mouseenter","titik",(()=>{a.getCanvas().style.cursor="pointer"})),a.on("mouseleave","titik",(()=>{a.getCanvas().style.cursor=""}))})),a.on("click",(e=>{if(0===a.queryRenderedFeatures(e.point).filter((t=>"route"===t.source)).length&&0===a.queryRenderedFeatures(e.point).filter((t=>"titik"===t.source)).length){let o=`${e.lngLat.lng} ${e.lngLat.lat}\n          <div>\n            <button type="submit" id="jadikan_depot" x="${e.lngLat.lng}" y="${e.lngLat.lat}" class="btn btn-primary btn-block">Jadikan Depot</button>\n            <button type="submit" id="jadikan_tujuan" x="${e.lngLat.lng}" y="${e.lngLat.lat}" class="btn btn-primary btn-block">Tambahkan ke Tujuan</button>\n            </div>\n          `;t=(new mapboxgl.Popup).setLngLat(e.lngLat).setHTML(o).addTo(a)}}))})),$("#tambah").click((function(){$("#tabelnya").append('<tr><td><input type="text" class="lng form-control"></td><td><input type="text" class="lat form-control"></td><td><input type="text" class="volume form-control"></td><td><input type="text" class="berat form-control"></td> <td><a href="#" class="DeleteButton">Hapus</a></td></tr>')})),$("#selesaikan").click((async function(){var t=$(".lng").map(((t,e)=>e.value)).get(),o=$(".lat").map(((t,e)=>e.value)).get(),n=$(".volume").map(((t,e)=>e.value)).get(),l=$(".berat").map(((t,e)=>e.value)).get();let r=[[Number($("#depot_long").val()),Number($("#depot_lat").val())]],s=[0];for(let e=0;e<t.length;e++){let a=Math.round(.5*l[e])+Math.round(.5*n[e]);r.push([Number(t[e]),Number(o[e])]),s.push(Number(a))}let i={locations:r,depotIndex:0,numVehicles:Number($("#jumlah_kendaraan").val()),vehicleCapacity:.5*Number($("#berat_max").val())+.5*Number($("#volume_max").val()),demands:s,computeTimeLimit:5e3,waktu_antar:Number($("#waktu_antar").val())},u=await axios.post("http://fosan.id:8854/selesaikan",i);if($("#isi_tabel").empty(),u){if(e.length){let t=0;for(let a=0;a<u.data.result.routes.length;a++)for(let o=0;o<u.data.result.routes[a].length;o++){let n=u.data.result.routes[a][o]-1;$("#isi_tabel").append(`      <tr>\n                            <td>${t++}</td>\n                            <td>${a+1}</td>\n                            <td>${e[n]["No SJ"]}</td>\n                            <td>${e[n]["Nama Customer"]}</td>\n                            <td>${e[n].M2}</td>\n                            <td>${e[n].KG}</td>\n                            <td>${o+1}</td>\n                        </tr>`)}}a.getSource("route").setData(u.data.geojson)}})),$("#map").on("click","#jadikan_depot",(function(){$("#depot_long").val($(this).attr("x")),$("#depot_lat").val($(this).attr("y")),t.remove()})),$("#map").on("click","#jadikan_tujuan",(function(){$("#tabelnya").append(`<tr><td><input type="text" class="lng form-control" value="${$(this).attr("x")}"></td><td><input type="text" value="${$(this).attr("y")}" class="lat form-control"></td>\n    <td><input type="text" class="volume form-control"></td><td><input type="text" class="berat form-control"></td>\n        <td><a href="#" class="DeleteButton">Hapus</a></td>\n        </tr>`),t.remove()})),$("#tabelnya").on("click",".DeleteButton",(function(){$(this).closest("tr").remove()}))})();